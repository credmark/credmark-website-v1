<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>A TECHNICAL ANALYSIS OF UNISWAP V3 | CREDMARK</title><meta content="Blog | Credmark" property="og:title"/><meta name="description" content="Welcome to the Credmark blog. Subscribe to find out about company updates and industry research."/><link rel="icon" href="/favicon.ico"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-201404361-1"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-201404361-1', {
              page_path: window.location.pathname,
            });
<<<<<<< HEAD:credmark-website/.serverless_nextjs/assets/static-pages/c2YWods6VWPWr2ykFGRll/blog/a-technical-analysis-of-uniswap-v3.html
          </script><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/a1ed85fb284bdb6e67c7.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a1ed85fb284bdb6e67c7.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-613fd858cdb9cf2af3be.js" defer=""></script><script src="/_next/static/chunks/framework-2191d16384373197bc0a.js" defer=""></script><script src="/_next/static/chunks/main-c4f2541b93e4ae8b71f8.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2025336f538f8a946c9a.js" defer=""></script><script src="/_next/static/chunks/584-77f839483f709b3b1040.js" defer=""></script><script src="/_next/static/chunks/383-7292f7c675c0d829e8c1.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-d5a3756679e4e66fd944.js" defer=""></script><script src="/_next/static/c2YWods6VWPWr2ykFGRll/_buildManifest.js" defer=""></script><script src="/_next/static/c2YWods6VWPWr2ykFGRll/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="nav"><div><div class="flex h-screen overflow-hidden max-w-7xl block m-auto"><div class="hidden md:flex md:flex-shrink-0"><div class="flex flex-col w-64"><div class="flex flex-col flex-grow pt-5 pb-4 overflow-y-auto"><div class="mt-5 flex-grow flex flex-col"><nav class="flex-1 px-2 pt-28 space-y-1 text-right"><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->Home</p><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->White Paper</p><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->Blog</p><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->Media</p><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->CCR</p><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->FAQ</p><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->The Team</p><a href="https://app.uniswap.org/#/swap?outputCurrency=0x68cfb82eacb9f198d508b514d898a403c449533e" target="_blank" rel="noreferrer" class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm active:font-medium rounded-md">Buy CMK</a></nav></div></div></div></div><div class="flex flex-col w-0 flex-1 overflow-hidden md:mr-40"><div class="relative z-10 h-16 md:h-24"><button type="button" class="my-3 pt-2.5 px-4 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 md:hidden"><svg fill="#3b0065" viewBox="0 0 100 80" width="30" height="30"><rect width="100" height="10"></rect><rect y="30" width="100" height="10"></rect><rect y="60" width="100" height="10"></rect></svg><span class="sr-only">Open sidebar</span></button><div class="grid grid-cols-3 h-24"><div></div><div class="hidden md:flex justify-center"><a href="https://credmark.com/" rel="noreferrer"><img width="45" class="flex justify-right pt-6" src="/assets/credmark-logo.png" alt="Credmark Logo"/></a></div><div class="flex flex-1 hidden md:flex medium:flex-grow-0 items-center justify-end mr-10 md:pt-2.5 mr-16"><a href="https://app.credmark.com/" target="_blank" rel="noreferrer"><img src="/assets/App.png" width="75" alt="App button"/></a></div></div></div><main class="flex-1 mb-2.5 relative overflow-y-hidden focus:outline-none rounded-4xl"><div data-simplebar="true" style="max-height:100%"><div class="simplebar-wrapper"><div class="simplebar-height-auto-observer-wrapper"><div class="simplebar-height-auto-observer"></div></div><div class="simplebar-mask"><div class="simplebar-offset"><div class="simplebar-content-wrapper"><div class="simplebar-content"><div class="bg-white pb-10"><div class="max-w-5xl block m-auto text-center px-5"><img id="blogbutton" class="h-auto cursor-pointer mt-40" fill="#3B0065" width="30" height="30" src="/assets/BackButton.svg"/><img id="blogPage" class="w-56 h-52 rounded-lg block m-auto mb-10" src="https://cdn.sanity.io/images/9y1au457/production/460e348d66ae4ba0bb36782d64f1a8d820158247-346x278.png"/><h1 class="text-xl md:px-20">A TECHNICAL ANALYSIS OF UNISWAP V3</h1><div class="text-left leading-loose pt-10 px-5 md:px-20"><p>Uniswap is the one of the world’s largest permissionless Distributed Exchange (DEX) on Ethereum by volume. After weeks of breathless anticipation, Uniswap has launched its new sophisticated product, Uniswap v3. In this article we’ll explore the exciting changes that were introduced, introduce some new terms, and help users understand the protocol to make good decisions.</p><p>While Uniswap v2 prioritized low risk and accessibility, v3 puts capital efficiency front and center, and the UI offers these options when making the trades. However, the additional features increase the complexity as we will explore.</p><p>Let’s understand this together as friends, from the viewpoint of “Alice” and “Bob”. Alice is a Uniswap v2 user and Bob is a Uniswap v3 user and both have $100,000 in their pockets for investment. They have decided to invest in the ETH/DAI pool. Let’s dive into the questions that come to mind: how they perceive the pool dynamics and some of the basis of their decisions to highlight the differences.</p><p>There are some parameters to consider for ETH/DAI pool at first glance to gain some insights about the current situation.</p><p><em>How can Alice and Bob provide liquidity to these pools?</em></p><p><em>What would be some things they need to be aware of while providing liquidity?</em></p><p>The first half of this article dives into the mathematical equations that govern the platform and the second half provides insight into how this exposes the user to more risk.</p><p><strong>For Alice on v2</strong></p><figure><img src="https://cdn.sanity.io/images/9y1au457/production/7dfbaa599c8ce29c2c30221ae1125b87524ecbcb-1999x1268.jpg"/></figure><p>Alice wants to provide $100,000 worth of liquidity to the ETH/DAI pool. For that Alice needs to have a certain amount of ETH and DAI. In v2, when providing liquidity you must add the tokens in such a ratio that they have equal dollar amounts.</p><p>Alice doesn’t need to calculate the ratio herself, the v2 interface manages it for her: 1 ETH = 3784 DAI. If she deposits 1 ETH, she will also have to deposit 3784 DAI for the equal ratio in this pool.</p><p>There are two transactions, and thus two gas costs to consider when adding liquidity to a pool: approving your wallet to be accessed by the ETH/DAI Uniswap v2 smart contract and moving the liquidity from your wallet to the smart contract itself.</p><p>When Alice adds liquidity, she gets a relative position in the pool, in this case about 0.0625% of the pool ($100,000 out of the pool’s total 159.806m). She’ll earn that percentage of all swap fees, which in Uniswap v2 is 0.3% of all swaps.</p><p>Whenever someone makes a ETH-DAI or DAI-ETH swap, her liquidity represents 0.0625% of the total liquidity, and thus she earns that percentage of the swap fee, which in Uniswap v2 is 0.3% of the swap. She earns fees on a simple volume based ratio, irrespective of the price of the tokens. When Alice earns liquidity fees, it is added back to the pool via liquidity tokens, compounding Alice’s liquidity position. When Alice is satisfied with her earnings she can remove them when she sees it fit.</p><p><strong>For Bob on v3</strong></p><figure><img src="https://cdn.sanity.io/images/9y1au457/production/957a5ef866ad692b75850ebb106cf7420e8fea0d-1999x1189.jpg"/></figure><p>Alice has had fun on v2, so she calls Bob, to see how his V3 experience is going.</p><p>Bob also has $100,000 to invest in his v3 pool. He likes Alice’s liquidity strategy, and wants to invest equal parts ETH and DAI and earn 0.3% liquidity fee. Well, life has changed for Bob in v3 and this is no longer a set-it-and-forget-it platform. Buckle up, Bob!</p><p>In order to increase capital efficiency abilities, v3 introduces concentrated liquidity. This allows for greater returns - but at the cost of complexity. Not only does Bob have to select the tokens (ETH &amp; DAI) he wants to provide liquidity for, but also the range of prices for those tokens.</p><p>Before Bob starts understanding V3, he has to understand the concept of concentrated liquidity. Since V3 allows the user to set their own price range, we have to understand how these price ranges are represented. Uniswap V3 introduces the concept of <strong>Ticks</strong> to accomplish this. Ticks are a way to express a range of prices that the tokens can be between. Ticks are integers so some math needs to be done to calculate the tick range he wants to provide liquidity for.</p><p>Bob needs to identify where the current price is represented on this number line. Each number on this number line represents a tick, that is just a representation of the value of sqrt(P). Bob needs to invest his assets as a range of ticks around the current tick. How does he calculate the tick based on current price and vice versa? Uniswap has given a formula to do that.</p><figure><img src="https://cdn.sanity.io/images/9y1au457/production/abf8fb577f2aa9f97abf3e14d334abe79828ae73-401x71.jpg"/></figure><p><em>Calculating current tick based on sqrt(price)</em><br/></p><figure><img src="https://cdn.sanity.io/images/9y1au457/production/232b307cb26b87b0eeb0afb55acff5103c10f1f6-362x69.jpg"/></figure><p><em>Calculating price based on current tick</em></p><p><br/>We need to calculate the liquidity range and square root of P, in order to do so, we need to consider our variables. Amount of DAI (<strong>y</strong>), Amount of ETH (<strong>x</strong>), and Liquidity (<strong>L</strong>) and Price (<strong>P</strong>).</p><p>Liquidity is calculated by taking the square root of x * y. In this case <em>187816.08</em></p><p>Price of the Position is calculated by taking the square root of y / x. In our case <em>54.1</em></p><p>The current tick value for this price is: 2932, It’s an integer because of the floor function.</p><p>It is very important to visualize your liquidity in a range interval as a combination of parts of liquidity within consecutive ticks, e.g. If you are providing liquidity from tick 7 to tick 10 of the pool this should be visualized as:</p><p>(tick7 &gt; tick8) + (tick8 &gt; tick9) + (tick9 &gt; tick10) + (tick10 &gt; tick11)</p><p>This visualization of position as combinations of small positions help understand some key points usually missed.</p><p>As long as the price is within two ticks, the lower tick is used as a representation of price. If the actual price either goes below lower tick or above upper tick after a swap, the reported price changes; otherwise although liquidity may change some amount, price remains pegged to the lower tick.</p><p>This tick is like a marker for Bob. Based on current pool prices, the price is at 91506 tick, so Bob will have to carefully think about creating liquidity around this tick.</p><p>Since the number line covers all integers, Uniswap v3 uses the concept of discrete tick spacing so that now all ticks are tracked. For example, a tick spacing of 2 will allow only integers such as -4, -2, 0, 2, 4.</p><p>Before Bob can make his position, he must understand</p><ul><li>Concentrated Liquidity on a single position,</li><li>Concentrated Liquidity in multiple positions, and</li><li>Active Liquidity vs Inactive Liquidity</li><li>Impermanent Loss</li><li>Range Orders.</li></ul><p><strong>Concentrated Liquidity in One Position</strong></p><p>Bob’s liquidity is no longer in a range of [0, inf). He also realizes that non-symmetrical positions make for different token ratios. He can set his own range in which he wants to invest. This creates a virtual interval of liquidity.</p><p>As an example, if ETH is trading at $4,300, Bob decides to set the interval of his investment from $3,500 to $5,900.</p><p>Bob buys the ETH and DAI tokens to amount to a total $50,000 in equal amounts. In this case $3,500 would represent lower bound of interval and $5,900 would represent upper bound of interval.</p><p>As price moves in this interval, the provided tokens get converted from ETH =&gt; DAI or DAI =&gt; ETH depending on the price curve. When the current price approaches either lower or upper bound of this order, he ends up with either only ETH or only DAI. In this case, he can either withdraw his position or wait for the price to come back in range. This is explored later in this article.</p><figure><img src="https://cdn.sanity.io/images/9y1au457/production/40a0d7437cf600cd0ef8896ddafd87e49515d6e3-738x557.jpg"/></figure><p>This is going to help Bob understand the effect of a swap order on the price. As, now the whole swap is executed as multiple small swaps, i.e. if swap is going to move the price from tick 7 to tick 9 which actually means moving the price from $P1 to $P2, the whole volume of swap is done as:</p><p><em>Total Volume of SWAP (Tick 7 -&gt; Tick 9) = Volume of SWAP (Tick 7-&gt; Tick 8) + Volume of SWAP (Tick 8 -&gt; Tick 9)</em></p><p>Bob earns the percent of capital provided by Bob between ticks 7 and 8, plus the percent of capital provided by Bob between ticks 8 and 9, times the fees collected from the trade in those ranges.</p><p>This makes Bob’s position more capital efficient than Alice’s. Now his liquidity is not calculated against total liquidity, but rather calculated as accumulation of volume ratio within his price ranges. Hence, as long as the price stays in his chosen range, he ends up making more money than he would have in v2 from the same initial investment amount.</p><p>This is very important to understand because now the fees that you are going to make by providing liquidity is going to be calculated based on these ticks.</p><h3>Multiple Liquidity Positions</h3><p><br/>Bob is an adventurous trader and he wants to create multiple intervals with his investment divided partially into each one of them. Basically, Bob wants his $100,000 to be divided in multiple custom ranges of liquidity, e.g. $10,000 into $4,000 to $4,500 price of ETH, $50,000 into $3,500 to $4,400 and the rest of $40,000 into $5,000 to $6,000. These ranges may/may not overlap. The V3 whitepaper has presented such representation in their work.</p><figure><img src="https://cdn.sanity.io/images/9y1au457/production/c763b9054116f5f3cbd5c62f216b43831193e837-1533x603.jpg"/></figure><p><br/><strong>Active Liquidity vs Inactive Liquidity</strong></p><p>If the current price or current tick is within your price/tick range, then your liquidity is considered active, and you are collecting fees If it’s not within your range, it&#x27;s inactive.</p><p>You may either wait for the current price to be within your interval or change your liquidity range so that the current price falls within the range provided, but rebalancing your position frequently may lead to huge losses.<br/>You can read more about it in this article. (<a href="https://reuptake.medium.com/liquidity-providing-in-uniswap-v3-2-5e24af7c346c">https://reuptake.medium.com/liquidity-providing-in-uniswap-v3-2-5e24af7c346c</a>)</p><p><strong>Impermanent Loss and Range Orders</strong></p><p>This brings up the concept of <strong>impermanent loss. </strong>In V2, as the price of an asset went up, an LP would miss out on profit as the ratio of asset 1 to asset 2 shifts in favor of the less valuable asset.</p><p>An example would be DAI/ETH. If ETH = 100 DAI and I add liquidity to DAI/ETH in v2 with $10000 DAI and 100 ETH for a total value of 20,000 DAI. I would be losing profits in the case where ETH rises. Since i own a percentage of the pool and not the assets themselves, if ETH doubles and hits 200 DAI, my position in the pool goes from 100 ETH to 71 ETH and 10000 DAI to 14142 DAI for a total of 28284 DAI. If i had simply held my ETH and DAI in a wallet, my total value would be 30000 DAI. Thus, I suffered an impermanent loss of 1716 DAI. My only hope is that enough volume occurred that I made up for the loss via fees.</p><p>How does V3 solve this? Well...it doesn’t really.</p><p>With V3, if the price of ETH falls outside of my configured price range, all my ETH is converted to DAI. If ETH hits a new all time high, how does that help me? As we’ve explored, I have the ability to distribute my 20000 DAI/ETH across several price ranges, earning fees as the price goes into each range and protecting myself against IL by distributing the volatile asset (ETH in this case) to multiple tranches. There is also a feature called a <strong>range order </strong>which is best explained by <a href="https://yitaek.medium.com/?source=post_page-----a04a8f2673bb--------------------------------">Yitaek Hwang</a><strong>:</strong></p><p><em>“[An] LP can deposit a single asset in a custom range outside the current price. Once the market price enters this range, the original asset is sold for the other pair while earning swap fees in the process. This strategy can complement market orders for profit taking or buying the dip.”</em></p><p>Since we know that Bob can provide less total liquidity than Alice to earn the same amount of fees, he can then take his remaining capital to set up a range order in which he converts ETH to DAI at a higher price to realize at least some of the gains he missed out on due to impermanent loss.</p><p><strong>What have we learned?</strong></p><p>Now after going through the Credmark Uniswap V3 class, Bob is ready to invest his liquidity. But one question remains: “<em>How do I choose the intervals to make the most money and minimize my downside?</em>”Well that’s a matter for another post.</p><p>Bob has the tools to answer that himself. He understands Ticks, Active Liquidity, Capital Efficiency on Swaps, Impermanent Loss and Range Orders. He now has the ability to build a risk diversified portfolio within one asset pool. Meaning, if Bob has a particularly strong understanding of the ETH/DAI volatility as well as the dynamics of V3’s new features, he can build a fully risk adjusted portfolio simply by having those 2 assets, saving himself time and the resources needed to convert to additional assets. Easy enough!</p><p>After looking at the thoughts and learnings of Alice and Bob, we hope you now have a deeper understanding of Uniswap v3. If you have any feedback or comments, please provide them in the comments section. Happy Learning!</p><p><strong>REFERENCES:</strong></p><p><strong>1. Uniswap V3 whitepaper (</strong><a href="https://uniswap.org/whitepaper-v3.pdf">https://uniswap.org/whitepaper-v3.pdf</a>)</p><p><strong>2. Uniswap V3 architecture - Finematics (<a href="https://www.youtube.com/watch?v=Ehm-OYBmlPM">https://www.youtube.com/watch?v=Ehm-OYBmlPM</a>)</strong></p><p><strong>3. Uniswap V3 docs - (https://docs.uniswap.org/)</strong></p><p></p></div></div></div></div></div></div></div><div class="simplebar-placeholder"></div></div><div class="simplebar-track simplebar-horizontal"><div class="simplebar-scrollbar"></div></div><div class="simplebar-track simplebar-vertical"><div class="simplebar-scrollbar"></div></div></div></main><div><div class="block m-auto"><div class="hidden sm:flex space-x-4 justify-center pb-1.5"><a class="pt-3.5 pl-20 text-xs" href="mailto:info@credmark.com" rel="noreferrer noopener" target="_blank"> info@credmark.com </a><a href="https://discord.com/invite/3dSfMqP3d4" target="_blank" rel="noreferrer"><img width="25" src="../assets/discordsingle.png" alt="Discord logo" target="_blank" rel="noreferrer"/></a><a href="https://t.me/credmark" target="_blank" rel="noreferrer"><img width="25" src="../assets/telegram.png" alt="Telegram logo" target="_blank" rel="noreferrer"/></a><a href="https://twitter.com/credmarkhq " target="_blank" rel="noreferrer"><img width="25" src="../assets/twitter.png" alt="Twitter logo" target="_blank" rel="noreferrer"/></a><p class="block m-auto text-center text-xs">© 2021 Credmark. All rights reserved</p></div></div><div class="sm:hidden block m-auto max-w-xs"><div class="flex space-x-4 justify-center pb-1.5"><a href="https://discord.com/invite/3dSfMqP3d4" target="_blank" rel="noreferrer"><img width="30" src="../assets/discordsingle.png" alt="Discord logo" target="_blank" rel="noreferrer"/></a><a href="https://t.me/credmark" target="_blank" rel="noreferrer"><img width="30" src="../assets/telegram.png" alt="Telegram logo" target="_blank" rel="noreferrer"/></a><a href="https://twitter.com/credmarkhq " target="_blank" rel="noreferrer"><img width="30" src="../assets/twitter.png" alt="Twitter logo" target="_blank" rel="noreferrer"/></a></div><div class="grid grid-cols-1"><a class="block m-auto text-xs" href="mailto:info@credmark.com" rel="noreferrer noopener" target="_blank">info@credmark.com</a><p class="block m-auto text-center text-xs mb-1.5">© 2021 Credmark.All rights<br/>reserved</p></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"author":"Nishchal Gaba","content":[{"_key":"3c126062aa1e","_type":"block","children":[{"_key":"33ccc9fe7fff","_type":"span","marks":[],"text":"Uniswap is the one of the world’s largest permissionless Distributed Exchange (DEX) on Ethereum by volume. After weeks of breathless anticipation, Uniswap has launched its new sophisticated product, Uniswap v3. In this article we’ll explore the exciting changes that were introduced, introduce some new terms, and help users understand the protocol to make good decisions."}],"markDefs":[],"style":"normal"},{"_key":"ddd23cf883d0","_type":"block","children":[{"_key":"9ee79d7c7d510","_type":"span","marks":[],"text":"While Uniswap v2 prioritized low risk and accessibility, v3 puts capital efficiency front and center, and the UI offers these options when making the trades. However, the additional features increase the complexity as we will explore."}],"markDefs":[],"style":"normal"},{"_key":"09b8dceb2116","_type":"block","children":[{"_key":"c79bcea7d96c0","_type":"span","marks":[],"text":"Let’s understand this together as friends, from the viewpoint of “Alice” and “Bob”. Alice is a Uniswap v2 user and Bob is a Uniswap v3 user and both have $100,000 in their pockets for investment. They have decided to invest in the ETH/DAI pool. Let’s dive into the questions that come to mind: how they perceive the pool dynamics and some of the basis of their decisions to highlight the differences."}],"markDefs":[],"style":"normal"},{"_key":"0d2c2c26448d","_type":"block","children":[{"_key":"b243187e55ab0","_type":"span","marks":[],"text":"There are some parameters to consider for ETH/DAI pool at first glance to gain some insights about the current situation."}],"markDefs":[],"style":"normal"},{"_key":"035d02055c8f","_type":"block","children":[{"_key":"16a7e9b530270","_type":"span","marks":["em"],"text":"How can Alice and Bob provide liquidity to these pools?"}],"markDefs":[],"style":"normal"},{"_key":"00de0fab140e","_type":"block","children":[{"_key":"549475c679550","_type":"span","marks":["em"],"text":"What would be some things they need to be aware of while providing liquidity?"}],"markDefs":[],"style":"normal"},{"_key":"70d78490f977","_type":"block","children":[{"_key":"c5982383633e0","_type":"span","marks":[],"text":"The first half of this article dives into the mathematical equations that govern the platform and the second half provides insight into how this exposes the user to more risk."}],"markDefs":[],"style":"normal"},{"_key":"132f29656a55","_type":"block","children":[{"_key":"e7c53b192081","_type":"span","marks":["strong"],"text":"For Alice on v2"}],"markDefs":[],"style":"normal"},{"_key":"c269d73d0767","_type":"image","asset":{"_ref":"image-7dfbaa599c8ce29c2c30221ae1125b87524ecbcb-1999x1268-jpg","_type":"reference"}},{"_key":"519e61634d1c","_type":"block","children":[{"_key":"9cb7dbdf51e2","_type":"span","marks":[],"text":"Alice wants to provide $100,000 worth of liquidity to the ETH/DAI pool. For that Alice needs to have a certain amount of ETH and DAI. In v2, when providing liquidity you must add the tokens in such a ratio that they have equal dollar amounts."}],"markDefs":[],"style":"normal"},{"_key":"17c14ec9a537","_type":"block","children":[{"_key":"4c94474d63070","_type":"span","marks":[],"text":"Alice doesn’t need to calculate the ratio herself, the v2 interface manages it for her: 1 ETH = 3784 DAI. If she deposits 1 ETH, she will also have to deposit 3784 DAI for the equal ratio in this pool."}],"markDefs":[],"style":"normal"},{"_key":"2524040bad6f","_type":"block","children":[{"_key":"b0b6393019330","_type":"span","marks":[],"text":"There are two transactions, and thus two gas costs to consider when adding liquidity to a pool: approving your wallet to be accessed by the ETH/DAI Uniswap v2 smart contract and moving the liquidity from your wallet to the smart contract itself."}],"markDefs":[],"style":"normal"},{"_key":"cfe80b6805dd","_type":"block","children":[{"_key":"b654f06378dd0","_type":"span","marks":[],"text":"When Alice adds liquidity, she gets a relative position in the pool, in this case about 0.0625% of the pool ($100,000 out of the pool’s total 159.806m). She’ll earn that percentage of all swap fees, which in Uniswap v2 is 0.3% of all swaps."}],"markDefs":[],"style":"normal"},{"_key":"a47c3e771139","_type":"block","children":[{"_key":"1f8d8dfc75800","_type":"span","marks":[],"text":"Whenever someone makes a ETH-DAI or DAI-ETH swap, her liquidity represents 0.0625% of the total liquidity, and thus she earns that percentage of the swap fee, which in Uniswap v2 is 0.3% of the swap. She earns fees on a simple volume based ratio, irrespective of the price of the tokens. When Alice earns liquidity fees, it is added back to the pool via liquidity tokens, compounding Alice’s liquidity position. When Alice is satisfied with her earnings she can remove them when she sees it fit."}],"markDefs":[],"style":"normal"},{"_key":"4704095e53b8","_type":"block","children":[{"_key":"6e2d837583e90","_type":"span","marks":["strong"],"text":"For Bob on v3"}],"markDefs":[],"style":"normal"},{"_key":"0c826a7c7086","_type":"image","asset":{"_ref":"image-957a5ef866ad692b75850ebb106cf7420e8fea0d-1999x1189-jpg","_type":"reference"}},{"_key":"9db8181e8d74","_type":"block","children":[{"_key":"1d0bac082e2a","_type":"span","marks":[],"text":"Alice has had fun on v2, so she calls Bob, to see how his V3 experience is going."}],"markDefs":[],"style":"normal"},{"_key":"5ae9b916ac75","_type":"block","children":[{"_key":"86af0ccd42140","_type":"span","marks":[],"text":"Bob also has $100,000 to invest in his v3 pool. He likes Alice’s liquidity strategy, and wants to invest equal parts ETH and DAI and earn 0.3% liquidity fee. Well, life has changed for Bob in v3 and this is no longer a set-it-and-forget-it platform. Buckle up, Bob!"}],"markDefs":[],"style":"normal"},{"_key":"1843c82195c6","_type":"block","children":[{"_key":"18f1ccd0e65b0","_type":"span","marks":[],"text":"In order to increase capital efficiency abilities, v3 introduces concentrated liquidity. This allows for greater returns - but at the cost of complexity. Not only does Bob have to select the tokens (ETH \u0026 DAI) he wants to provide liquidity for, but also the range of prices for those tokens."}],"markDefs":[],"style":"normal"},{"_key":"4af41490b1b5","_type":"block","children":[{"_key":"d170e8bed61a0","_type":"span","marks":[],"text":"Before Bob starts understanding V3, he has to understand the concept of concentrated liquidity. Since V3 allows the user to set their own price range, we have to understand how these price ranges are represented. Uniswap V3 introduces the concept of "},{"_key":"d170e8bed61a1","_type":"span","marks":["strong"],"text":"Ticks"},{"_key":"d170e8bed61a2","_type":"span","marks":[],"text":" to accomplish this. Ticks are a way to express a range of prices that the tokens can be between. Ticks are integers so some math needs to be done to calculate the tick range he wants to provide liquidity for."}],"markDefs":[],"style":"normal"},{"_key":"665cc2858069","_type":"block","children":[{"_key":"00430b434c440","_type":"span","marks":[],"text":"Bob needs to identify where the current price is represented on this number line. Each number on this number line represents a tick, that is just a representation of the value of sqrt(P). Bob needs to invest his assets as a range of ticks around the current tick. How does he calculate the tick based on current price and vice versa? Uniswap has given a formula to do that."}],"markDefs":[],"style":"normal"},{"_key":"be01df5517e4","_type":"image","asset":{"_ref":"image-abf8fb577f2aa9f97abf3e14d334abe79828ae73-401x71-jpg","_type":"reference"}},{"_key":"857230abf94a","_type":"block","children":[{"_key":"d72b8721af2c","_type":"span","marks":["em"],"text":"Calculating current tick based on sqrt(price)"},{"_key":"4c3229cec5930","_type":"span","marks":[],"text":"\n"}],"markDefs":[],"style":"normal"},{"_key":"4d9ebbb62ab2","_type":"image","asset":{"_ref":"image-232b307cb26b87b0eeb0afb55acff5103c10f1f6-362x69-jpg","_type":"reference"}},{"_key":"03a997fab249","_type":"block","children":[{"_key":"8d7773b1d34d","_type":"span","marks":["em"],"text":"Calculating price based on current tick"}],"markDefs":[],"style":"normal"},{"_key":"a1c53d9f264b","_type":"block","children":[{"_key":"1fe66f89d3130","_type":"span","marks":[],"text":"\nWe need to calculate the liquidity range and square root of P, in order to do so, we need to consider our variables. Amount of DAI ("},{"_key":"389416187281","_type":"span","marks":["strong"],"text":"y"},{"_key":"dc51b7f6b812","_type":"span","marks":[],"text":"), Amount of ETH ("},{"_key":"fb853ce880c8","_type":"span","marks":["strong"],"text":"x"},{"_key":"d1dfcbe17e7d","_type":"span","marks":[],"text":"), and Liquidity ("},{"_key":"5d27483d290f","_type":"span","marks":["strong"],"text":"L"},{"_key":"7afea40dc7b9","_type":"span","marks":[],"text":") and Price ("},{"_key":"91589f2b0c60","_type":"span","marks":["strong"],"text":"P"},{"_key":"da72242edaa3","_type":"span","marks":[],"text":")."}],"markDefs":[],"style":"normal"},{"_key":"c00f9526639f","_type":"block","children":[{"_key":"9107a0ee6b2b0","_type":"span","marks":[],"text":"Liquidity is calculated by taking the square root of x * y. In this case "},{"_key":"9107a0ee6b2b1","_type":"span","marks":["em"],"text":"187816.08"}],"markDefs":[],"style":"normal"},{"_key":"e62831f712f1","_type":"block","children":[{"_key":"90d1dfbd958f0","_type":"span","marks":[],"text":"Price of the Position is calculated by taking the square root of y / x. In our case "},{"_key":"90d1dfbd958f1","_type":"span","marks":["em"],"text":"54.1"}],"markDefs":[],"style":"normal"},{"_key":"c01d60afd82f","_type":"block","children":[{"_key":"3e481d3e9c890","_type":"span","marks":[],"text":"The current tick value for this price is: 2932, It’s an integer because of the floor function."}],"markDefs":[],"style":"normal"},{"_key":"c8f98160a478","_type":"block","children":[{"_key":"34dfad00053e0","_type":"span","marks":[],"text":"It is very important to visualize your liquidity in a range interval as a combination of parts of liquidity within consecutive ticks, e.g. If you are providing liquidity from tick 7 to tick 10 of the pool this should be visualized as:"}],"markDefs":[],"style":"normal"},{"_key":"adeb2f0fcdae","_type":"block","children":[{"_key":"6d3036e104220","_type":"span","marks":[],"text":"(tick7 \u003e tick8) + (tick8 \u003e tick9) + (tick9 \u003e tick10) + (tick10 \u003e tick11)"}],"markDefs":[],"style":"normal"},{"_key":"79779bf68382","_type":"block","children":[{"_key":"1bdcfae22d0a0","_type":"span","marks":[],"text":"This visualization of position as combinations of small positions help understand some key points usually missed."}],"markDefs":[],"style":"normal"},{"_key":"6fe8e7daa92d","_type":"block","children":[{"_key":"07fdfa7893140","_type":"span","marks":[],"text":"As long as the price is within two ticks, the lower tick is used as a representation of price. If the actual price either goes below lower tick or above upper tick after a swap, the reported price changes; otherwise although liquidity may change some amount, price remains pegged to the lower tick."}],"markDefs":[],"style":"normal"},{"_key":"6f680802747d","_type":"block","children":[{"_key":"38098be68a840","_type":"span","marks":[],"text":"This tick is like a marker for Bob. Based on current pool prices, the price is at 91506 tick, so Bob will have to carefully think about creating liquidity around this tick."}],"markDefs":[],"style":"normal"},{"_key":"302a16fca331","_type":"block","children":[{"_key":"efcf51d857920","_type":"span","marks":[],"text":"Since the number line covers all integers, Uniswap v3 uses the concept of discrete tick spacing so that now all ticks are tracked. For example, a tick spacing of 2 will allow only integers such as -4, -2, 0, 2, 4."}],"markDefs":[],"style":"normal"},{"_key":"258b96a797b4","_type":"block","children":[{"_key":"51e4264b8b720","_type":"span","marks":[],"text":"Before Bob can make his position, he must understand"}],"markDefs":[],"style":"normal"},{"_key":"f6abda8b39a4","_type":"block","children":[{"_key":"14c240c5ed640","_type":"span","marks":[],"text":"Concentrated Liquidity on a single position,"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"07c051f06eb0","_type":"block","children":[{"_key":"865b9ce9d29a0","_type":"span","marks":[],"text":"Concentrated Liquidity in multiple positions, and"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"fe44f82d79c4","_type":"block","children":[{"_key":"e872a14497220","_type":"span","marks":[],"text":"Active Liquidity vs Inactive Liquidity"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"b84df7609cfe","_type":"block","children":[{"_key":"d46f8600481c0","_type":"span","marks":[],"text":"Impermanent Loss"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"b3a86579b10a","_type":"block","children":[{"_key":"1abbf897bdba0","_type":"span","marks":[],"text":"Range Orders."}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"6b31d7cbb168","_type":"block","children":[{"_key":"b8d5e6b771df","_type":"span","marks":["strong"],"text":"Concentrated Liquidity in One Position"}],"markDefs":[],"style":"normal"},{"_key":"7c9027bc10f7","_type":"block","children":[{"_key":"978c7a072c2d","_type":"span","marks":[],"text":"Bob’s liquidity is no longer in a range of [0, inf). He also realizes that non-symmetrical positions make for different token ratios. He can set his own range in which he wants to invest. This creates a virtual interval of liquidity."}],"markDefs":[],"style":"normal"},{"_key":"e6d7e78e88cb","_type":"block","children":[{"_key":"9ed9d2defc440","_type":"span","marks":[],"text":"As an example, if ETH is trading at $4,300, Bob decides to set the interval of his investment from $3,500 to $5,900."}],"markDefs":[],"style":"normal"},{"_key":"405f4e244964","_type":"block","children":[{"_key":"83c9992813540","_type":"span","marks":[],"text":"Bob buys the ETH and DAI tokens to amount to a total $50,000 in equal amounts. In this case $3,500 would represent lower bound of interval and $5,900 would represent upper bound of interval."}],"markDefs":[],"style":"normal"},{"_key":"ea0d34a09d68","_type":"block","children":[{"_key":"636486d23a9f0","_type":"span","marks":[],"text":"As price moves in this interval, the provided tokens get converted from ETH =\u003e DAI or DAI =\u003e ETH depending on the price curve. When the current price approaches either lower or upper bound of this order, he ends up with either only ETH or only DAI. In this case, he can either withdraw his position or wait for the price to come back in range. This is explored later in this article."}],"markDefs":[],"style":"normal"},{"_key":"1fae200d786f","_type":"image","asset":{"_ref":"image-40a0d7437cf600cd0ef8896ddafd87e49515d6e3-738x557-jpg","_type":"reference"}},{"_key":"06122a994b41","_type":"block","children":[{"_key":"1138fe65d8ae","_type":"span","marks":[],"text":"This is going to help Bob understand the effect of a swap order on the price. As, now the whole swap is executed as multiple small swaps, i.e. if swap is going to move the price from tick 7 to tick 9 which actually means moving the price from $P1 to $P2, the whole volume of swap is done as:"}],"markDefs":[],"style":"normal"},{"_key":"32196afdd65b","_type":"block","children":[{"_key":"2ab17158439a0","_type":"span","marks":["em"],"text":"Total Volume of SWAP (Tick 7 -\u003e Tick 9) = Volume of SWAP (Tick 7-\u003e Tick 8) + Volume of SWAP (Tick 8 -\u003e Tick 9)"}],"markDefs":[],"style":"normal"},{"_key":"9d05a93e6d1b","_type":"block","children":[{"_key":"5f03dd7d114c0","_type":"span","marks":[],"text":"Bob earns the percent of capital provided by Bob between ticks 7 and 8, plus the percent of capital provided by Bob between ticks 8 and 9, times the fees collected from the trade in those ranges."}],"markDefs":[],"style":"normal"},{"_key":"c935ad4e471d","_type":"block","children":[{"_key":"28af1a6304b50","_type":"span","marks":[],"text":"This makes Bob’s position more capital efficient than Alice’s. Now his liquidity is not calculated against total liquidity, but rather calculated as accumulation of volume ratio within his price ranges. Hence, as long as the price stays in his chosen range, he ends up making more money than he would have in v2 from the same initial investment amount."}],"markDefs":[],"style":"normal"},{"_key":"36b242257e44","_type":"block","children":[{"_key":"b45edfe6c8050","_type":"span","marks":[],"text":"This is very important to understand because now the fees that you are going to make by providing liquidity is going to be calculated based on these ticks."}],"markDefs":[],"style":"normal"},{"_key":"b023b41497d6","_type":"block","children":[{"_key":"01cd5d2b0b8a","_type":"span","marks":[],"text":"Multiple Liquidity Positions"}],"markDefs":[],"style":"h3"},{"_key":"5736c20f31b4","_type":"block","children":[{"_key":"971fcc0281030","_type":"span","marks":[],"text":"\nBob is an adventurous trader and he wants to create multiple intervals with his investment divided partially into each one of them. Basically, Bob wants his $100,000 to be divided in multiple custom ranges of liquidity, e.g. $10,000 into $4,000 to $4,500 price of ETH, $50,000 into $3,500 to $4,400 and the rest of $40,000 into $5,000 to $6,000. These ranges may/may not overlap. The V3 whitepaper has presented such representation in their work."}],"markDefs":[],"style":"normal"},{"_key":"5ab7eeeb9793","_type":"image","asset":{"_ref":"image-c763b9054116f5f3cbd5c62f216b43831193e837-1533x603-jpg","_type":"reference"}},{"_key":"a6eae4774a87","_type":"block","children":[{"_key":"3074b22ef6060","_type":"span","marks":[],"text":"\n"},{"_key":"1074b95c7210","_type":"span","marks":["strong"],"text":"Active Liquidity vs Inactive Liquidity"}],"markDefs":[],"style":"normal"},{"_key":"6aea6e7496b3","_type":"block","children":[{"_key":"0344576d7530","_type":"span","marks":[],"text":"If the current price or current tick is within your price/tick range, then your liquidity is considered active, and you are collecting fees If it’s not within your range, it's inactive."}],"markDefs":[],"style":"normal"},{"_key":"cbb00f1a195a","_type":"block","children":[{"_key":"419cee073c480","_type":"span","marks":[],"text":"You may either wait for the current price to be within your interval or change your liquidity range so that the current price falls within the range provided, but rebalancing your position frequently may lead to huge losses.\nYou can read more about it in this article. ("},{"_key":"419cee073c481","_type":"span","marks":["b26b3a59cfc7"],"text":"https://reuptake.medium.com/liquidity-providing-in-uniswap-v3-2-5e24af7c346c"},{"_key":"419cee073c482","_type":"span","marks":[],"text":")"}],"markDefs":[{"_key":"b26b3a59cfc7","_type":"link","href":"https://reuptake.medium.com/liquidity-providing-in-uniswap-v3-2-5e24af7c346c"}],"style":"normal"},{"_key":"24ca7a603522","_type":"block","children":[{"_key":"d4b9b01245ca","_type":"span","marks":["strong"],"text":"Impermanent Loss and Range Orders"}],"markDefs":[],"style":"normal"},{"_key":"b48ed3a52b01","_type":"block","children":[{"_key":"a906dfaf3752","_type":"span","marks":[],"text":"This brings up the concept of "},{"_key":"cebd79c5b80d","_type":"span","marks":["strong"],"text":"impermanent loss. "},{"_key":"5ef00ed5d497","_type":"span","marks":[],"text":"In V2, as the price of an asset went up, an LP would miss out on profit as the ratio of asset 1 to asset 2 shifts in favor of the less valuable asset."}],"markDefs":[],"style":"normal"},{"_key":"3e332ce52317","_type":"block","children":[{"_key":"b8cce4b13c6e0","_type":"span","marks":[],"text":"An example would be DAI/ETH. If ETH = 100 DAI and I add liquidity to DAI/ETH in v2 with $10000 DAI and 100 ETH for a total value of 20,000 DAI. I would be losing profits in the case where ETH rises. Since i own a percentage of the pool and not the assets themselves, if ETH doubles and hits 200 DAI, my position in the pool goes from 100 ETH to 71 ETH and 10000 DAI to 14142 DAI for a total of 28284 DAI. If i had simply held my ETH and DAI in a wallet, my total value would be 30000 DAI. Thus, I suffered an impermanent loss of 1716 DAI. My only hope is that enough volume occurred that I made up for the loss via fees."}],"markDefs":[],"style":"normal"},{"_key":"f22648c518ce","_type":"block","children":[{"_key":"406efa800b680","_type":"span","marks":[],"text":"How does V3 solve this? Well...it doesn’t really."}],"markDefs":[],"style":"normal"},{"_key":"70666a06f82b","_type":"block","children":[{"_key":"3c3474a945e70","_type":"span","marks":[],"text":"With V3, if the price of ETH falls outside of my configured price range, all my ETH is converted to DAI. If ETH hits a new all time high, how does that help me? As we’ve explored, I have the ability to distribute my 20000 DAI/ETH across several price ranges, earning fees as the price goes into each range and protecting myself against IL by distributing the volatile asset (ETH in this case) to multiple tranches. There is also a feature called a "},{"_key":"3c3474a945e71","_type":"span","marks":["strong"],"text":"range order "},{"_key":"3c3474a945e72","_type":"span","marks":[],"text":"which is best explained by "},{"_key":"3c3474a945e73","_type":"span","marks":["0151e1ae0e18"],"text":"Yitaek Hwang"},{"_key":"3c3474a945e74","_type":"span","marks":["strong"],"text":":"}],"markDefs":[{"_key":"0151e1ae0e18","_type":"link","href":"https://yitaek.medium.com/?source=post_page-----a04a8f2673bb--------------------------------"}],"style":"normal"},{"_key":"d61ab63c4a8f","_type":"block","children":[{"_key":"1f64da5a8bdd0","_type":"span","marks":["em"],"text":"“[An] LP can deposit a single asset in a custom range outside the current price. Once the market price enters this range, the original asset is sold for the other pair while earning swap fees in the process. This strategy can complement market orders for profit taking or buying the dip.”"}],"markDefs":[],"style":"normal"},{"_key":"02f922374044","_type":"block","children":[{"_key":"7681755408810","_type":"span","marks":[],"text":"Since we know that Bob can provide less total liquidity than Alice to earn the same amount of fees, he can then take his remaining capital to set up a range order in which he converts ETH to DAI at a higher price to realize at least some of the gains he missed out on due to impermanent loss."}],"markDefs":[],"style":"normal"},{"_key":"4680eb0acfff","_type":"block","children":[{"_key":"6e6a989dc94c","_type":"span","marks":["strong"],"text":"What have we learned?"}],"markDefs":[],"style":"normal"},{"_key":"ba76e9e2b896","_type":"block","children":[{"_key":"3add7e5c7d3d","_type":"span","marks":[],"text":"Now after going through the Credmark Uniswap V3 class, Bob is ready to invest his liquidity. But one question remains: “"},{"_key":"46fb28709cd8","_type":"span","marks":["em"],"text":"How do I choose the intervals to make the most money and minimize my downside?"},{"_key":"21da335bcf56","_type":"span","marks":[],"text":"”Well that’s a matter for another post."}],"markDefs":[],"style":"normal"},{"_key":"3c9315b00091","_type":"block","children":[{"_key":"7f94680d3f690","_type":"span","marks":[],"text":"Bob has the tools to answer that himself. He understands Ticks, Active Liquidity, Capital Efficiency on Swaps, Impermanent Loss and Range Orders. He now has the ability to build a risk diversified portfolio within one asset pool. Meaning, if Bob has a particularly strong understanding of the ETH/DAI volatility as well as the dynamics of V3’s new features, he can build a fully risk adjusted portfolio simply by having those 2 assets, saving himself time and the resources needed to convert to additional assets. Easy enough!"}],"markDefs":[],"style":"normal"},{"_key":"067e0909c37e","_type":"block","children":[{"_key":"d11181405d5a0","_type":"span","marks":[],"text":"After looking at the thoughts and learnings of Alice and Bob, we hope you now have a deeper understanding of Uniswap v3. If you have any feedback or comments, please provide them in the comments section. Happy Learning!"}],"markDefs":[],"style":"normal"},{"_key":"8731e29b4cb6","_type":"block","children":[{"_key":"36a4d89f1936","_type":"span","marks":["strong"],"text":"REFERENCES:"}],"markDefs":[],"style":"normal"},{"_key":"32d770281cc4","_type":"block","children":[{"_key":"a7773bc4105a0","_type":"span","marks":["strong"],"text":"1. Uniswap V3 whitepaper ("},{"_key":"a7773bc4105a1","_type":"span","marks":["e986ad215b80"],"text":"https://uniswap.org/whitepaper-v3.pdf"},{"_key":"a7773bc4105a2","_type":"span","marks":[],"text":")"}],"markDefs":[{"_key":"e986ad215b80","_type":"link","href":"https://uniswap.org/whitepaper-v3.pdf"}],"style":"normal"},{"_key":"c705a28a128d","_type":"block","children":[{"_key":"fde87373a3170","_type":"span","marks":["strong"],"text":"2. Uniswap V3 architecture - Finematics ("},{"_key":"fde87373a3171","_type":"span","marks":["9861e73277a1","strong"],"text":"https://www.youtube.com/watch?v=Ehm-OYBmlPM"},{"_key":"83ccd46f0ef8","_type":"span","marks":["strong"],"text":")"}],"markDefs":[{"_key":"9861e73277a1","_type":"link","href":"https://www.youtube.com/watch?v=Ehm-OYBmlPM"}],"style":"normal"},{"_key":"5d5a0ba0ba19","_type":"block","children":[{"_key":"5d214a9e89f2","_type":"span","marks":["strong"],"text":"3. Uniswap V3 docs - (https://docs.uniswap.org/)"}],"markDefs":[],"style":"normal"},{"_key":"17f138c49d9e","_type":"block","children":[{"_key":"b329ca8cf449","_type":"span","marks":[],"text":""}],"markDefs":[],"style":"normal"}],"date":"2021-05-20T07:39:00.000Z","mainImage":"https://cdn.sanity.io/images/9y1au457/production/460e348d66ae4ba0bb36782d64f1a8d820158247-346x278.png","slug":"a-technical-analysis-of-uniswap-v3","subtitle":null,"title":"A TECHNICAL ANALYSIS OF UNISWAP V3"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"a-technical-analysis-of-uniswap-v3"},"buildId":"c2YWods6VWPWr2ykFGRll","runtimeConfig":{},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>
=======
          </script><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/a1ed85fb284bdb6e67c7.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a1ed85fb284bdb6e67c7.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script src="/_next/static/chunks/webpack-613fd858cdb9cf2af3be.js" defer=""></script><script src="/_next/static/chunks/framework-2191d16384373197bc0a.js" defer=""></script><script src="/_next/static/chunks/main-c4f2541b93e4ae8b71f8.js" defer=""></script><script src="/_next/static/chunks/pages/_app-2025336f538f8a946c9a.js" defer=""></script><script src="/_next/static/chunks/584-77f839483f709b3b1040.js" defer=""></script><script src="/_next/static/chunks/383-7292f7c675c0d829e8c1.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-d5a3756679e4e66fd944.js" defer=""></script><script src="/_next/static/Wd04JdrV7EafBKCrkdwgE/_buildManifest.js" defer=""></script><script src="/_next/static/Wd04JdrV7EafBKCrkdwgE/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="nav"><div><div class="flex h-screen overflow-hidden max-w-7xl block m-auto"><div class="hidden md:flex md:flex-shrink-0"><div class="flex flex-col w-64"><div class="flex flex-col flex-grow pt-5 pb-4 overflow-y-auto"><div class="mt-5 flex-grow flex flex-col"><nav class="flex-1 px-2 pt-28 space-y-1 text-right"><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->Home</p><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->White Paper</p><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->Blog</p><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->Media</p><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->CCR</p><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->FAQ</p><p class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm hover:font-medium rounded-md"> <!-- -->The Team</p><a href="https://app.uniswap.org/#/swap?outputCurrency=0x68cfb82eacb9f198d508b514d898a403c449533e" target="_blank" rel="noreferrer" class="cursor-pointer group flex flex-row-reverse pr-5 px-2 py-2 text-sm active:font-medium rounded-md">Buy CMK</a></nav></div></div></div></div><div class="flex flex-col w-0 flex-1 overflow-hidden md:mr-40"><div class="relative z-10 h-16 md:h-24"><button type="button" class="my-3 pt-2.5 px-4 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500 md:hidden"><svg fill="#3b0065" viewBox="0 0 100 80" width="30" height="30"><rect width="100" height="10"></rect><rect y="30" width="100" height="10"></rect><rect y="60" width="100" height="10"></rect></svg><span class="sr-only">Open sidebar</span></button><div class="grid grid-cols-3 h-24"><div></div><div class="hidden md:flex justify-center"><a href="https://credmark.com/" rel="noreferrer"><img width="45" class="flex justify-right pt-6" src="/assets/credmark-logo.png" alt="Credmark Logo"/></a></div><div class="flex flex-1 hidden md:flex medium:flex-grow-0 items-center justify-end mr-10 md:pt-2.5 mr-16"><a href="https://app.credmark.com/" target="_blank" rel="noreferrer"><img src="/assets/App.png" width="75" alt="App button"/></a></div></div></div><main class="flex-1 mb-2.5 relative overflow-y-hidden focus:outline-none rounded-4xl"><div data-simplebar="true" style="max-height:100%"><div class="simplebar-wrapper"><div class="simplebar-height-auto-observer-wrapper"><div class="simplebar-height-auto-observer"></div></div><div class="simplebar-mask"><div class="simplebar-offset"><div class="simplebar-content-wrapper"><div class="simplebar-content"><div class="bg-white pb-10"><div class="max-w-5xl block m-auto text-center px-5"><img id="blogbutton" class="h-auto cursor-pointer mt-40" fill="#3B0065" width="30" height="30" src="/assets/BackButton.svg"/><img id="blogPage" class="w-56 h-52 rounded-lg block m-auto mb-10" src="https://cdn.sanity.io/images/9y1au457/production/460e348d66ae4ba0bb36782d64f1a8d820158247-346x278.png"/><h1 class="text-xl md:px-20">A TECHNICAL ANALYSIS OF UNISWAP V3</h1><div class="text-left leading-loose pt-10 px-5 md:px-20"><p>Uniswap is the one of the world’s largest permissionless Distributed Exchange (DEX) on Ethereum by volume. After weeks of breathless anticipation, Uniswap has launched its new sophisticated product, Uniswap v3. In this article we’ll explore the exciting changes that were introduced, introduce some new terms, and help users understand the protocol to make good decisions.</p><p>While Uniswap v2 prioritized low risk and accessibility, v3 puts capital efficiency front and center, and the UI offers these options when making the trades. However, the additional features increase the complexity as we will explore.</p><p>Let’s understand this together as friends, from the viewpoint of “Alice” and “Bob”. Alice is a Uniswap v2 user and Bob is a Uniswap v3 user and both have $100,000 in their pockets for investment. They have decided to invest in the ETH/DAI pool. Let’s dive into the questions that come to mind: how they perceive the pool dynamics and some of the basis of their decisions to highlight the differences.</p><p>There are some parameters to consider for ETH/DAI pool at first glance to gain some insights about the current situation.</p><p><em>How can Alice and Bob provide liquidity to these pools?</em></p><p><em>What would be some things they need to be aware of while providing liquidity?</em></p><p>The first half of this article dives into the mathematical equations that govern the platform and the second half provides insight into how this exposes the user to more risk.</p><p><strong>For Alice on v2</strong></p><figure><img src="https://cdn.sanity.io/images/9y1au457/production/7dfbaa599c8ce29c2c30221ae1125b87524ecbcb-1999x1268.jpg"/></figure><p>Alice wants to provide $100,000 worth of liquidity to the ETH/DAI pool. For that Alice needs to have a certain amount of ETH and DAI. In v2, when providing liquidity you must add the tokens in such a ratio that they have equal dollar amounts.</p><p>Alice doesn’t need to calculate the ratio herself, the v2 interface manages it for her: 1 ETH = 3784 DAI. If she deposits 1 ETH, she will also have to deposit 3784 DAI for the equal ratio in this pool.</p><p>There are two transactions, and thus two gas costs to consider when adding liquidity to a pool: approving your wallet to be accessed by the ETH/DAI Uniswap v2 smart contract and moving the liquidity from your wallet to the smart contract itself.</p><p>When Alice adds liquidity, she gets a relative position in the pool, in this case about 0.0625% of the pool ($100,000 out of the pool’s total 159.806m). She’ll earn that percentage of all swap fees, which in Uniswap v2 is 0.3% of all swaps.</p><p>Whenever someone makes a ETH-DAI or DAI-ETH swap, her liquidity represents 0.0625% of the total liquidity, and thus she earns that percentage of the swap fee, which in Uniswap v2 is 0.3% of the swap. She earns fees on a simple volume based ratio, irrespective of the price of the tokens. When Alice earns liquidity fees, it is added back to the pool via liquidity tokens, compounding Alice’s liquidity position. When Alice is satisfied with her earnings she can remove them when she sees it fit.</p><p><strong>For Bob on v3</strong></p><figure><img src="https://cdn.sanity.io/images/9y1au457/production/957a5ef866ad692b75850ebb106cf7420e8fea0d-1999x1189.jpg"/></figure><p>Alice has had fun on v2, so she calls Bob, to see how his V3 experience is going.</p><p>Bob also has $100,000 to invest in his v3 pool. He likes Alice’s liquidity strategy, and wants to invest equal parts ETH and DAI and earn 0.3% liquidity fee. Well, life has changed for Bob in v3 and this is no longer a set-it-and-forget-it platform. Buckle up, Bob!</p><p>In order to increase capital efficiency abilities, v3 introduces concentrated liquidity. This allows for greater returns - but at the cost of complexity. Not only does Bob have to select the tokens (ETH &amp; DAI) he wants to provide liquidity for, but also the range of prices for those tokens.</p><p>Before Bob starts understanding V3, he has to understand the concept of concentrated liquidity. Since V3 allows the user to set their own price range, we have to understand how these price ranges are represented. Uniswap V3 introduces the concept of <strong>Ticks</strong> to accomplish this. Ticks are a way to express a range of prices that the tokens can be between. Ticks are integers so some math needs to be done to calculate the tick range he wants to provide liquidity for.</p><p>Bob needs to identify where the current price is represented on this number line. Each number on this number line represents a tick, that is just a representation of the value of sqrt(P). Bob needs to invest his assets as a range of ticks around the current tick. How does he calculate the tick based on current price and vice versa? Uniswap has given a formula to do that.</p><figure><img src="https://cdn.sanity.io/images/9y1au457/production/abf8fb577f2aa9f97abf3e14d334abe79828ae73-401x71.jpg"/></figure><p><em>Calculating current tick based on sqrt(price)</em><br/></p><figure><img src="https://cdn.sanity.io/images/9y1au457/production/232b307cb26b87b0eeb0afb55acff5103c10f1f6-362x69.jpg"/></figure><p><em>Calculating price based on current tick</em></p><p><br/>We need to calculate the liquidity range and square root of P, in order to do so, we need to consider our variables. Amount of DAI (<strong>y</strong>), Amount of ETH (<strong>x</strong>), and Liquidity (<strong>L</strong>) and Price (<strong>P</strong>).</p><p>Liquidity is calculated by taking the square root of x * y. In this case <em>187816.08</em></p><p>Price of the Position is calculated by taking the square root of y / x. In our case <em>54.1</em></p><p>The current tick value for this price is: 2932, It’s an integer because of the floor function.</p><p>It is very important to visualize your liquidity in a range interval as a combination of parts of liquidity within consecutive ticks, e.g. If you are providing liquidity from tick 7 to tick 10 of the pool this should be visualized as:</p><p>(tick7 &gt; tick8) + (tick8 &gt; tick9) + (tick9 &gt; tick10) + (tick10 &gt; tick11)</p><p>This visualization of position as combinations of small positions help understand some key points usually missed.</p><p>As long as the price is within two ticks, the lower tick is used as a representation of price. If the actual price either goes below lower tick or above upper tick after a swap, the reported price changes; otherwise although liquidity may change some amount, price remains pegged to the lower tick.</p><p>This tick is like a marker for Bob. Based on current pool prices, the price is at 91506 tick, so Bob will have to carefully think about creating liquidity around this tick.</p><p>Since the number line covers all integers, Uniswap v3 uses the concept of discrete tick spacing so that now all ticks are tracked. For example, a tick spacing of 2 will allow only integers such as -4, -2, 0, 2, 4.</p><p>Before Bob can make his position, he must understand</p><ul><li>Concentrated Liquidity on a single position,</li><li>Concentrated Liquidity in multiple positions, and</li><li>Active Liquidity vs Inactive Liquidity</li><li>Impermanent Loss</li><li>Range Orders.</li></ul><p><strong>Concentrated Liquidity in One Position</strong></p><p>Bob’s liquidity is no longer in a range of [0, inf). He also realizes that non-symmetrical positions make for different token ratios. He can set his own range in which he wants to invest. This creates a virtual interval of liquidity.</p><p>As an example, if ETH is trading at $4,300, Bob decides to set the interval of his investment from $3,500 to $5,900.</p><p>Bob buys the ETH and DAI tokens to amount to a total $50,000 in equal amounts. In this case $3,500 would represent lower bound of interval and $5,900 would represent upper bound of interval.</p><p>As price moves in this interval, the provided tokens get converted from ETH =&gt; DAI or DAI =&gt; ETH depending on the price curve. When the current price approaches either lower or upper bound of this order, he ends up with either only ETH or only DAI. In this case, he can either withdraw his position or wait for the price to come back in range. This is explored later in this article.</p><figure><img src="https://cdn.sanity.io/images/9y1au457/production/40a0d7437cf600cd0ef8896ddafd87e49515d6e3-738x557.jpg"/></figure><p>This is going to help Bob understand the effect of a swap order on the price. As, now the whole swap is executed as multiple small swaps, i.e. if swap is going to move the price from tick 7 to tick 9 which actually means moving the price from $P1 to $P2, the whole volume of swap is done as:</p><p><em>Total Volume of SWAP (Tick 7 -&gt; Tick 9) = Volume of SWAP (Tick 7-&gt; Tick 8) + Volume of SWAP (Tick 8 -&gt; Tick 9)</em></p><p>Bob earns the percent of capital provided by Bob between ticks 7 and 8, plus the percent of capital provided by Bob between ticks 8 and 9, times the fees collected from the trade in those ranges.</p><p>This makes Bob’s position more capital efficient than Alice’s. Now his liquidity is not calculated against total liquidity, but rather calculated as accumulation of volume ratio within his price ranges. Hence, as long as the price stays in his chosen range, he ends up making more money than he would have in v2 from the same initial investment amount.</p><p>This is very important to understand because now the fees that you are going to make by providing liquidity is going to be calculated based on these ticks.</p><h3>Multiple Liquidity Positions</h3><p><br/>Bob is an adventurous trader and he wants to create multiple intervals with his investment divided partially into each one of them. Basically, Bob wants his $100,000 to be divided in multiple custom ranges of liquidity, e.g. $10,000 into $4,000 to $4,500 price of ETH, $50,000 into $3,500 to $4,400 and the rest of $40,000 into $5,000 to $6,000. These ranges may/may not overlap. The V3 whitepaper has presented such representation in their work.</p><figure><img src="https://cdn.sanity.io/images/9y1au457/production/c763b9054116f5f3cbd5c62f216b43831193e837-1533x603.jpg"/></figure><p><br/><strong>Active Liquidity vs Inactive Liquidity</strong></p><p>If the current price or current tick is within your price/tick range, then your liquidity is considered active, and you are collecting fees If it’s not within your range, it&#x27;s inactive.</p><p>You may either wait for the current price to be within your interval or change your liquidity range so that the current price falls within the range provided, but rebalancing your position frequently may lead to huge losses.<br/>You can read more about it in this article. (<a href="https://reuptake.medium.com/liquidity-providing-in-uniswap-v3-2-5e24af7c346c">https://reuptake.medium.com/liquidity-providing-in-uniswap-v3-2-5e24af7c346c</a>)</p><p><strong>Impermanent Loss and Range Orders</strong></p><p>This brings up the concept of <strong>impermanent loss. </strong>In V2, as the price of an asset went up, an LP would miss out on profit as the ratio of asset 1 to asset 2 shifts in favor of the less valuable asset.</p><p>An example would be DAI/ETH. If ETH = 100 DAI and I add liquidity to DAI/ETH in v2 with $10000 DAI and 100 ETH for a total value of 20,000 DAI. I would be losing profits in the case where ETH rises. Since i own a percentage of the pool and not the assets themselves, if ETH doubles and hits 200 DAI, my position in the pool goes from 100 ETH to 71 ETH and 10000 DAI to 14142 DAI for a total of 28284 DAI. If i had simply held my ETH and DAI in a wallet, my total value would be 30000 DAI. Thus, I suffered an impermanent loss of 1716 DAI. My only hope is that enough volume occurred that I made up for the loss via fees.</p><p>How does V3 solve this? Well...it doesn’t really.</p><p>With V3, if the price of ETH falls outside of my configured price range, all my ETH is converted to DAI. If ETH hits a new all time high, how does that help me? As we’ve explored, I have the ability to distribute my 20000 DAI/ETH across several price ranges, earning fees as the price goes into each range and protecting myself against IL by distributing the volatile asset (ETH in this case) to multiple tranches. There is also a feature called a <strong>range order </strong>which is best explained by <a href="https://yitaek.medium.com/?source=post_page-----a04a8f2673bb--------------------------------">Yitaek Hwang</a><strong>:</strong></p><p><em>“[An] LP can deposit a single asset in a custom range outside the current price. Once the market price enters this range, the original asset is sold for the other pair while earning swap fees in the process. This strategy can complement market orders for profit taking or buying the dip.”</em></p><p>Since we know that Bob can provide less total liquidity than Alice to earn the same amount of fees, he can then take his remaining capital to set up a range order in which he converts ETH to DAI at a higher price to realize at least some of the gains he missed out on due to impermanent loss.</p><p><strong>What have we learned?</strong></p><p>Now after going through the Credmark Uniswap V3 class, Bob is ready to invest his liquidity. But one question remains: “<em>How do I choose the intervals to make the most money and minimize my downside?</em>”Well that’s a matter for another post.</p><p>Bob has the tools to answer that himself. He understands Ticks, Active Liquidity, Capital Efficiency on Swaps, Impermanent Loss and Range Orders. He now has the ability to build a risk diversified portfolio within one asset pool. Meaning, if Bob has a particularly strong understanding of the ETH/DAI volatility as well as the dynamics of V3’s new features, he can build a fully risk adjusted portfolio simply by having those 2 assets, saving himself time and the resources needed to convert to additional assets. Easy enough!</p><p>After looking at the thoughts and learnings of Alice and Bob, we hope you now have a deeper understanding of Uniswap v3. If you have any feedback or comments, please provide them in the comments section. Happy Learning!</p><p><strong>REFERENCES:</strong></p><p><strong>1. Uniswap V3 whitepaper (</strong><a href="https://uniswap.org/whitepaper-v3.pdf">https://uniswap.org/whitepaper-v3.pdf</a>)</p><p><strong>2. Uniswap V3 architecture - Finematics (<a href="https://www.youtube.com/watch?v=Ehm-OYBmlPM">https://www.youtube.com/watch?v=Ehm-OYBmlPM</a>)</strong></p><p><strong>3. Uniswap V3 docs - (https://docs.uniswap.org/)</strong></p><p></p></div></div></div></div></div></div></div><div class="simplebar-placeholder"></div></div><div class="simplebar-track simplebar-horizontal"><div class="simplebar-scrollbar"></div></div><div class="simplebar-track simplebar-vertical"><div class="simplebar-scrollbar"></div></div></div></main><div><div class="block m-auto"><div class="hidden sm:flex space-x-4 justify-center pb-1.5"><a class="pt-3.5 pl-20 text-xs" href="mailto:info@credmark.com" rel="noreferrer noopener" target="_blank"> info@credmark.com </a><a href="https://discord.com/invite/3dSfMqP3d4" target="_blank" rel="noreferrer"><img width="25" src="../assets/discordsingle.png" alt="Discord logo" target="_blank" rel="noreferrer"/></a><a href="https://t.me/credmark" target="_blank" rel="noreferrer"><img width="25" src="../assets/telegram.png" alt="Telegram logo" target="_blank" rel="noreferrer"/></a><a href="https://twitter.com/credmarkhq " target="_blank" rel="noreferrer"><img width="25" src="../assets/twitter.png" alt="Twitter logo" target="_blank" rel="noreferrer"/></a><p class="block m-auto text-center text-xs">© 2021 Credmark. All rights reserved</p></div></div><div class="sm:hidden block m-auto max-w-xs"><div class="flex space-x-4 justify-center pb-1.5"><a href="https://discord.com/invite/3dSfMqP3d4" target="_blank" rel="noreferrer"><img width="30" src="../assets/discordsingle.png" alt="Discord logo" target="_blank" rel="noreferrer"/></a><a href="https://t.me/credmark" target="_blank" rel="noreferrer"><img width="30" src="../assets/telegram.png" alt="Telegram logo" target="_blank" rel="noreferrer"/></a><a href="https://twitter.com/credmarkhq " target="_blank" rel="noreferrer"><img width="30" src="../assets/twitter.png" alt="Twitter logo" target="_blank" rel="noreferrer"/></a></div><div class="grid grid-cols-1"><a class="block m-auto text-xs" href="mailto:info@credmark.com" rel="noreferrer noopener" target="_blank">info@credmark.com</a><p class="block m-auto text-center text-xs mb-1.5">© 2021 Credmark.All rights<br/>reserved</p></div></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"author":"Nishchal Gaba","content":[{"_key":"3c126062aa1e","_type":"block","children":[{"_key":"33ccc9fe7fff","_type":"span","marks":[],"text":"Uniswap is the one of the world’s largest permissionless Distributed Exchange (DEX) on Ethereum by volume. After weeks of breathless anticipation, Uniswap has launched its new sophisticated product, Uniswap v3. In this article we’ll explore the exciting changes that were introduced, introduce some new terms, and help users understand the protocol to make good decisions."}],"markDefs":[],"style":"normal"},{"_key":"ddd23cf883d0","_type":"block","children":[{"_key":"9ee79d7c7d510","_type":"span","marks":[],"text":"While Uniswap v2 prioritized low risk and accessibility, v3 puts capital efficiency front and center, and the UI offers these options when making the trades. However, the additional features increase the complexity as we will explore."}],"markDefs":[],"style":"normal"},{"_key":"09b8dceb2116","_type":"block","children":[{"_key":"c79bcea7d96c0","_type":"span","marks":[],"text":"Let’s understand this together as friends, from the viewpoint of “Alice” and “Bob”. Alice is a Uniswap v2 user and Bob is a Uniswap v3 user and both have $100,000 in their pockets for investment. They have decided to invest in the ETH/DAI pool. Let’s dive into the questions that come to mind: how they perceive the pool dynamics and some of the basis of their decisions to highlight the differences."}],"markDefs":[],"style":"normal"},{"_key":"0d2c2c26448d","_type":"block","children":[{"_key":"b243187e55ab0","_type":"span","marks":[],"text":"There are some parameters to consider for ETH/DAI pool at first glance to gain some insights about the current situation."}],"markDefs":[],"style":"normal"},{"_key":"035d02055c8f","_type":"block","children":[{"_key":"16a7e9b530270","_type":"span","marks":["em"],"text":"How can Alice and Bob provide liquidity to these pools?"}],"markDefs":[],"style":"normal"},{"_key":"00de0fab140e","_type":"block","children":[{"_key":"549475c679550","_type":"span","marks":["em"],"text":"What would be some things they need to be aware of while providing liquidity?"}],"markDefs":[],"style":"normal"},{"_key":"70d78490f977","_type":"block","children":[{"_key":"c5982383633e0","_type":"span","marks":[],"text":"The first half of this article dives into the mathematical equations that govern the platform and the second half provides insight into how this exposes the user to more risk."}],"markDefs":[],"style":"normal"},{"_key":"132f29656a55","_type":"block","children":[{"_key":"e7c53b192081","_type":"span","marks":["strong"],"text":"For Alice on v2"}],"markDefs":[],"style":"normal"},{"_key":"c269d73d0767","_type":"image","asset":{"_ref":"image-7dfbaa599c8ce29c2c30221ae1125b87524ecbcb-1999x1268-jpg","_type":"reference"}},{"_key":"519e61634d1c","_type":"block","children":[{"_key":"9cb7dbdf51e2","_type":"span","marks":[],"text":"Alice wants to provide $100,000 worth of liquidity to the ETH/DAI pool. For that Alice needs to have a certain amount of ETH and DAI. In v2, when providing liquidity you must add the tokens in such a ratio that they have equal dollar amounts."}],"markDefs":[],"style":"normal"},{"_key":"17c14ec9a537","_type":"block","children":[{"_key":"4c94474d63070","_type":"span","marks":[],"text":"Alice doesn’t need to calculate the ratio herself, the v2 interface manages it for her: 1 ETH = 3784 DAI. If she deposits 1 ETH, she will also have to deposit 3784 DAI for the equal ratio in this pool."}],"markDefs":[],"style":"normal"},{"_key":"2524040bad6f","_type":"block","children":[{"_key":"b0b6393019330","_type":"span","marks":[],"text":"There are two transactions, and thus two gas costs to consider when adding liquidity to a pool: approving your wallet to be accessed by the ETH/DAI Uniswap v2 smart contract and moving the liquidity from your wallet to the smart contract itself."}],"markDefs":[],"style":"normal"},{"_key":"cfe80b6805dd","_type":"block","children":[{"_key":"b654f06378dd0","_type":"span","marks":[],"text":"When Alice adds liquidity, she gets a relative position in the pool, in this case about 0.0625% of the pool ($100,000 out of the pool’s total 159.806m). She’ll earn that percentage of all swap fees, which in Uniswap v2 is 0.3% of all swaps."}],"markDefs":[],"style":"normal"},{"_key":"a47c3e771139","_type":"block","children":[{"_key":"1f8d8dfc75800","_type":"span","marks":[],"text":"Whenever someone makes a ETH-DAI or DAI-ETH swap, her liquidity represents 0.0625% of the total liquidity, and thus she earns that percentage of the swap fee, which in Uniswap v2 is 0.3% of the swap. She earns fees on a simple volume based ratio, irrespective of the price of the tokens. When Alice earns liquidity fees, it is added back to the pool via liquidity tokens, compounding Alice’s liquidity position. When Alice is satisfied with her earnings she can remove them when she sees it fit."}],"markDefs":[],"style":"normal"},{"_key":"4704095e53b8","_type":"block","children":[{"_key":"6e2d837583e90","_type":"span","marks":["strong"],"text":"For Bob on v3"}],"markDefs":[],"style":"normal"},{"_key":"0c826a7c7086","_type":"image","asset":{"_ref":"image-957a5ef866ad692b75850ebb106cf7420e8fea0d-1999x1189-jpg","_type":"reference"}},{"_key":"9db8181e8d74","_type":"block","children":[{"_key":"1d0bac082e2a","_type":"span","marks":[],"text":"Alice has had fun on v2, so she calls Bob, to see how his V3 experience is going."}],"markDefs":[],"style":"normal"},{"_key":"5ae9b916ac75","_type":"block","children":[{"_key":"86af0ccd42140","_type":"span","marks":[],"text":"Bob also has $100,000 to invest in his v3 pool. He likes Alice’s liquidity strategy, and wants to invest equal parts ETH and DAI and earn 0.3% liquidity fee. Well, life has changed for Bob in v3 and this is no longer a set-it-and-forget-it platform. Buckle up, Bob!"}],"markDefs":[],"style":"normal"},{"_key":"1843c82195c6","_type":"block","children":[{"_key":"18f1ccd0e65b0","_type":"span","marks":[],"text":"In order to increase capital efficiency abilities, v3 introduces concentrated liquidity. This allows for greater returns - but at the cost of complexity. Not only does Bob have to select the tokens (ETH \u0026 DAI) he wants to provide liquidity for, but also the range of prices for those tokens."}],"markDefs":[],"style":"normal"},{"_key":"4af41490b1b5","_type":"block","children":[{"_key":"d170e8bed61a0","_type":"span","marks":[],"text":"Before Bob starts understanding V3, he has to understand the concept of concentrated liquidity. Since V3 allows the user to set their own price range, we have to understand how these price ranges are represented. Uniswap V3 introduces the concept of "},{"_key":"d170e8bed61a1","_type":"span","marks":["strong"],"text":"Ticks"},{"_key":"d170e8bed61a2","_type":"span","marks":[],"text":" to accomplish this. Ticks are a way to express a range of prices that the tokens can be between. Ticks are integers so some math needs to be done to calculate the tick range he wants to provide liquidity for."}],"markDefs":[],"style":"normal"},{"_key":"665cc2858069","_type":"block","children":[{"_key":"00430b434c440","_type":"span","marks":[],"text":"Bob needs to identify where the current price is represented on this number line. Each number on this number line represents a tick, that is just a representation of the value of sqrt(P). Bob needs to invest his assets as a range of ticks around the current tick. How does he calculate the tick based on current price and vice versa? Uniswap has given a formula to do that."}],"markDefs":[],"style":"normal"},{"_key":"be01df5517e4","_type":"image","asset":{"_ref":"image-abf8fb577f2aa9f97abf3e14d334abe79828ae73-401x71-jpg","_type":"reference"}},{"_key":"857230abf94a","_type":"block","children":[{"_key":"d72b8721af2c","_type":"span","marks":["em"],"text":"Calculating current tick based on sqrt(price)"},{"_key":"4c3229cec5930","_type":"span","marks":[],"text":"\n"}],"markDefs":[],"style":"normal"},{"_key":"4d9ebbb62ab2","_type":"image","asset":{"_ref":"image-232b307cb26b87b0eeb0afb55acff5103c10f1f6-362x69-jpg","_type":"reference"}},{"_key":"03a997fab249","_type":"block","children":[{"_key":"8d7773b1d34d","_type":"span","marks":["em"],"text":"Calculating price based on current tick"}],"markDefs":[],"style":"normal"},{"_key":"a1c53d9f264b","_type":"block","children":[{"_key":"1fe66f89d3130","_type":"span","marks":[],"text":"\nWe need to calculate the liquidity range and square root of P, in order to do so, we need to consider our variables. Amount of DAI ("},{"_key":"389416187281","_type":"span","marks":["strong"],"text":"y"},{"_key":"dc51b7f6b812","_type":"span","marks":[],"text":"), Amount of ETH ("},{"_key":"fb853ce880c8","_type":"span","marks":["strong"],"text":"x"},{"_key":"d1dfcbe17e7d","_type":"span","marks":[],"text":"), and Liquidity ("},{"_key":"5d27483d290f","_type":"span","marks":["strong"],"text":"L"},{"_key":"7afea40dc7b9","_type":"span","marks":[],"text":") and Price ("},{"_key":"91589f2b0c60","_type":"span","marks":["strong"],"text":"P"},{"_key":"da72242edaa3","_type":"span","marks":[],"text":")."}],"markDefs":[],"style":"normal"},{"_key":"c00f9526639f","_type":"block","children":[{"_key":"9107a0ee6b2b0","_type":"span","marks":[],"text":"Liquidity is calculated by taking the square root of x * y. In this case "},{"_key":"9107a0ee6b2b1","_type":"span","marks":["em"],"text":"187816.08"}],"markDefs":[],"style":"normal"},{"_key":"e62831f712f1","_type":"block","children":[{"_key":"90d1dfbd958f0","_type":"span","marks":[],"text":"Price of the Position is calculated by taking the square root of y / x. In our case "},{"_key":"90d1dfbd958f1","_type":"span","marks":["em"],"text":"54.1"}],"markDefs":[],"style":"normal"},{"_key":"c01d60afd82f","_type":"block","children":[{"_key":"3e481d3e9c890","_type":"span","marks":[],"text":"The current tick value for this price is: 2932, It’s an integer because of the floor function."}],"markDefs":[],"style":"normal"},{"_key":"c8f98160a478","_type":"block","children":[{"_key":"34dfad00053e0","_type":"span","marks":[],"text":"It is very important to visualize your liquidity in a range interval as a combination of parts of liquidity within consecutive ticks, e.g. If you are providing liquidity from tick 7 to tick 10 of the pool this should be visualized as:"}],"markDefs":[],"style":"normal"},{"_key":"adeb2f0fcdae","_type":"block","children":[{"_key":"6d3036e104220","_type":"span","marks":[],"text":"(tick7 \u003e tick8) + (tick8 \u003e tick9) + (tick9 \u003e tick10) + (tick10 \u003e tick11)"}],"markDefs":[],"style":"normal"},{"_key":"79779bf68382","_type":"block","children":[{"_key":"1bdcfae22d0a0","_type":"span","marks":[],"text":"This visualization of position as combinations of small positions help understand some key points usually missed."}],"markDefs":[],"style":"normal"},{"_key":"6fe8e7daa92d","_type":"block","children":[{"_key":"07fdfa7893140","_type":"span","marks":[],"text":"As long as the price is within two ticks, the lower tick is used as a representation of price. If the actual price either goes below lower tick or above upper tick after a swap, the reported price changes; otherwise although liquidity may change some amount, price remains pegged to the lower tick."}],"markDefs":[],"style":"normal"},{"_key":"6f680802747d","_type":"block","children":[{"_key":"38098be68a840","_type":"span","marks":[],"text":"This tick is like a marker for Bob. Based on current pool prices, the price is at 91506 tick, so Bob will have to carefully think about creating liquidity around this tick."}],"markDefs":[],"style":"normal"},{"_key":"302a16fca331","_type":"block","children":[{"_key":"efcf51d857920","_type":"span","marks":[],"text":"Since the number line covers all integers, Uniswap v3 uses the concept of discrete tick spacing so that now all ticks are tracked. For example, a tick spacing of 2 will allow only integers such as -4, -2, 0, 2, 4."}],"markDefs":[],"style":"normal"},{"_key":"258b96a797b4","_type":"block","children":[{"_key":"51e4264b8b720","_type":"span","marks":[],"text":"Before Bob can make his position, he must understand"}],"markDefs":[],"style":"normal"},{"_key":"f6abda8b39a4","_type":"block","children":[{"_key":"14c240c5ed640","_type":"span","marks":[],"text":"Concentrated Liquidity on a single position,"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"07c051f06eb0","_type":"block","children":[{"_key":"865b9ce9d29a0","_type":"span","marks":[],"text":"Concentrated Liquidity in multiple positions, and"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"fe44f82d79c4","_type":"block","children":[{"_key":"e872a14497220","_type":"span","marks":[],"text":"Active Liquidity vs Inactive Liquidity"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"b84df7609cfe","_type":"block","children":[{"_key":"d46f8600481c0","_type":"span","marks":[],"text":"Impermanent Loss"}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"b3a86579b10a","_type":"block","children":[{"_key":"1abbf897bdba0","_type":"span","marks":[],"text":"Range Orders."}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"6b31d7cbb168","_type":"block","children":[{"_key":"b8d5e6b771df","_type":"span","marks":["strong"],"text":"Concentrated Liquidity in One Position"}],"markDefs":[],"style":"normal"},{"_key":"7c9027bc10f7","_type":"block","children":[{"_key":"978c7a072c2d","_type":"span","marks":[],"text":"Bob’s liquidity is no longer in a range of [0, inf). He also realizes that non-symmetrical positions make for different token ratios. He can set his own range in which he wants to invest. This creates a virtual interval of liquidity."}],"markDefs":[],"style":"normal"},{"_key":"e6d7e78e88cb","_type":"block","children":[{"_key":"9ed9d2defc440","_type":"span","marks":[],"text":"As an example, if ETH is trading at $4,300, Bob decides to set the interval of his investment from $3,500 to $5,900."}],"markDefs":[],"style":"normal"},{"_key":"405f4e244964","_type":"block","children":[{"_key":"83c9992813540","_type":"span","marks":[],"text":"Bob buys the ETH and DAI tokens to amount to a total $50,000 in equal amounts. In this case $3,500 would represent lower bound of interval and $5,900 would represent upper bound of interval."}],"markDefs":[],"style":"normal"},{"_key":"ea0d34a09d68","_type":"block","children":[{"_key":"636486d23a9f0","_type":"span","marks":[],"text":"As price moves in this interval, the provided tokens get converted from ETH =\u003e DAI or DAI =\u003e ETH depending on the price curve. When the current price approaches either lower or upper bound of this order, he ends up with either only ETH or only DAI. In this case, he can either withdraw his position or wait for the price to come back in range. This is explored later in this article."}],"markDefs":[],"style":"normal"},{"_key":"1fae200d786f","_type":"image","asset":{"_ref":"image-40a0d7437cf600cd0ef8896ddafd87e49515d6e3-738x557-jpg","_type":"reference"}},{"_key":"06122a994b41","_type":"block","children":[{"_key":"1138fe65d8ae","_type":"span","marks":[],"text":"This is going to help Bob understand the effect of a swap order on the price. As, now the whole swap is executed as multiple small swaps, i.e. if swap is going to move the price from tick 7 to tick 9 which actually means moving the price from $P1 to $P2, the whole volume of swap is done as:"}],"markDefs":[],"style":"normal"},{"_key":"32196afdd65b","_type":"block","children":[{"_key":"2ab17158439a0","_type":"span","marks":["em"],"text":"Total Volume of SWAP (Tick 7 -\u003e Tick 9) = Volume of SWAP (Tick 7-\u003e Tick 8) + Volume of SWAP (Tick 8 -\u003e Tick 9)"}],"markDefs":[],"style":"normal"},{"_key":"9d05a93e6d1b","_type":"block","children":[{"_key":"5f03dd7d114c0","_type":"span","marks":[],"text":"Bob earns the percent of capital provided by Bob between ticks 7 and 8, plus the percent of capital provided by Bob between ticks 8 and 9, times the fees collected from the trade in those ranges."}],"markDefs":[],"style":"normal"},{"_key":"c935ad4e471d","_type":"block","children":[{"_key":"28af1a6304b50","_type":"span","marks":[],"text":"This makes Bob’s position more capital efficient than Alice’s. Now his liquidity is not calculated against total liquidity, but rather calculated as accumulation of volume ratio within his price ranges. Hence, as long as the price stays in his chosen range, he ends up making more money than he would have in v2 from the same initial investment amount."}],"markDefs":[],"style":"normal"},{"_key":"36b242257e44","_type":"block","children":[{"_key":"b45edfe6c8050","_type":"span","marks":[],"text":"This is very important to understand because now the fees that you are going to make by providing liquidity is going to be calculated based on these ticks."}],"markDefs":[],"style":"normal"},{"_key":"b023b41497d6","_type":"block","children":[{"_key":"01cd5d2b0b8a","_type":"span","marks":[],"text":"Multiple Liquidity Positions"}],"markDefs":[],"style":"h3"},{"_key":"5736c20f31b4","_type":"block","children":[{"_key":"971fcc0281030","_type":"span","marks":[],"text":"\nBob is an adventurous trader and he wants to create multiple intervals with his investment divided partially into each one of them. Basically, Bob wants his $100,000 to be divided in multiple custom ranges of liquidity, e.g. $10,000 into $4,000 to $4,500 price of ETH, $50,000 into $3,500 to $4,400 and the rest of $40,000 into $5,000 to $6,000. These ranges may/may not overlap. The V3 whitepaper has presented such representation in their work."}],"markDefs":[],"style":"normal"},{"_key":"5ab7eeeb9793","_type":"image","asset":{"_ref":"image-c763b9054116f5f3cbd5c62f216b43831193e837-1533x603-jpg","_type":"reference"}},{"_key":"a6eae4774a87","_type":"block","children":[{"_key":"3074b22ef6060","_type":"span","marks":[],"text":"\n"},{"_key":"1074b95c7210","_type":"span","marks":["strong"],"text":"Active Liquidity vs Inactive Liquidity"}],"markDefs":[],"style":"normal"},{"_key":"6aea6e7496b3","_type":"block","children":[{"_key":"0344576d7530","_type":"span","marks":[],"text":"If the current price or current tick is within your price/tick range, then your liquidity is considered active, and you are collecting fees If it’s not within your range, it's inactive."}],"markDefs":[],"style":"normal"},{"_key":"cbb00f1a195a","_type":"block","children":[{"_key":"419cee073c480","_type":"span","marks":[],"text":"You may either wait for the current price to be within your interval or change your liquidity range so that the current price falls within the range provided, but rebalancing your position frequently may lead to huge losses.\nYou can read more about it in this article. ("},{"_key":"419cee073c481","_type":"span","marks":["b26b3a59cfc7"],"text":"https://reuptake.medium.com/liquidity-providing-in-uniswap-v3-2-5e24af7c346c"},{"_key":"419cee073c482","_type":"span","marks":[],"text":")"}],"markDefs":[{"_key":"b26b3a59cfc7","_type":"link","href":"https://reuptake.medium.com/liquidity-providing-in-uniswap-v3-2-5e24af7c346c"}],"style":"normal"},{"_key":"24ca7a603522","_type":"block","children":[{"_key":"d4b9b01245ca","_type":"span","marks":["strong"],"text":"Impermanent Loss and Range Orders"}],"markDefs":[],"style":"normal"},{"_key":"b48ed3a52b01","_type":"block","children":[{"_key":"a906dfaf3752","_type":"span","marks":[],"text":"This brings up the concept of "},{"_key":"cebd79c5b80d","_type":"span","marks":["strong"],"text":"impermanent loss. "},{"_key":"5ef00ed5d497","_type":"span","marks":[],"text":"In V2, as the price of an asset went up, an LP would miss out on profit as the ratio of asset 1 to asset 2 shifts in favor of the less valuable asset."}],"markDefs":[],"style":"normal"},{"_key":"3e332ce52317","_type":"block","children":[{"_key":"b8cce4b13c6e0","_type":"span","marks":[],"text":"An example would be DAI/ETH. If ETH = 100 DAI and I add liquidity to DAI/ETH in v2 with $10000 DAI and 100 ETH for a total value of 20,000 DAI. I would be losing profits in the case where ETH rises. Since i own a percentage of the pool and not the assets themselves, if ETH doubles and hits 200 DAI, my position in the pool goes from 100 ETH to 71 ETH and 10000 DAI to 14142 DAI for a total of 28284 DAI. If i had simply held my ETH and DAI in a wallet, my total value would be 30000 DAI. Thus, I suffered an impermanent loss of 1716 DAI. My only hope is that enough volume occurred that I made up for the loss via fees."}],"markDefs":[],"style":"normal"},{"_key":"f22648c518ce","_type":"block","children":[{"_key":"406efa800b680","_type":"span","marks":[],"text":"How does V3 solve this? Well...it doesn’t really."}],"markDefs":[],"style":"normal"},{"_key":"70666a06f82b","_type":"block","children":[{"_key":"3c3474a945e70","_type":"span","marks":[],"text":"With V3, if the price of ETH falls outside of my configured price range, all my ETH is converted to DAI. If ETH hits a new all time high, how does that help me? As we’ve explored, I have the ability to distribute my 20000 DAI/ETH across several price ranges, earning fees as the price goes into each range and protecting myself against IL by distributing the volatile asset (ETH in this case) to multiple tranches. There is also a feature called a "},{"_key":"3c3474a945e71","_type":"span","marks":["strong"],"text":"range order "},{"_key":"3c3474a945e72","_type":"span","marks":[],"text":"which is best explained by "},{"_key":"3c3474a945e73","_type":"span","marks":["0151e1ae0e18"],"text":"Yitaek Hwang"},{"_key":"3c3474a945e74","_type":"span","marks":["strong"],"text":":"}],"markDefs":[{"_key":"0151e1ae0e18","_type":"link","href":"https://yitaek.medium.com/?source=post_page-----a04a8f2673bb--------------------------------"}],"style":"normal"},{"_key":"d61ab63c4a8f","_type":"block","children":[{"_key":"1f64da5a8bdd0","_type":"span","marks":["em"],"text":"“[An] LP can deposit a single asset in a custom range outside the current price. Once the market price enters this range, the original asset is sold for the other pair while earning swap fees in the process. This strategy can complement market orders for profit taking or buying the dip.”"}],"markDefs":[],"style":"normal"},{"_key":"02f922374044","_type":"block","children":[{"_key":"7681755408810","_type":"span","marks":[],"text":"Since we know that Bob can provide less total liquidity than Alice to earn the same amount of fees, he can then take his remaining capital to set up a range order in which he converts ETH to DAI at a higher price to realize at least some of the gains he missed out on due to impermanent loss."}],"markDefs":[],"style":"normal"},{"_key":"4680eb0acfff","_type":"block","children":[{"_key":"6e6a989dc94c","_type":"span","marks":["strong"],"text":"What have we learned?"}],"markDefs":[],"style":"normal"},{"_key":"ba76e9e2b896","_type":"block","children":[{"_key":"3add7e5c7d3d","_type":"span","marks":[],"text":"Now after going through the Credmark Uniswap V3 class, Bob is ready to invest his liquidity. But one question remains: “"},{"_key":"46fb28709cd8","_type":"span","marks":["em"],"text":"How do I choose the intervals to make the most money and minimize my downside?"},{"_key":"21da335bcf56","_type":"span","marks":[],"text":"”Well that’s a matter for another post."}],"markDefs":[],"style":"normal"},{"_key":"3c9315b00091","_type":"block","children":[{"_key":"7f94680d3f690","_type":"span","marks":[],"text":"Bob has the tools to answer that himself. He understands Ticks, Active Liquidity, Capital Efficiency on Swaps, Impermanent Loss and Range Orders. He now has the ability to build a risk diversified portfolio within one asset pool. Meaning, if Bob has a particularly strong understanding of the ETH/DAI volatility as well as the dynamics of V3’s new features, he can build a fully risk adjusted portfolio simply by having those 2 assets, saving himself time and the resources needed to convert to additional assets. Easy enough!"}],"markDefs":[],"style":"normal"},{"_key":"067e0909c37e","_type":"block","children":[{"_key":"d11181405d5a0","_type":"span","marks":[],"text":"After looking at the thoughts and learnings of Alice and Bob, we hope you now have a deeper understanding of Uniswap v3. If you have any feedback or comments, please provide them in the comments section. Happy Learning!"}],"markDefs":[],"style":"normal"},{"_key":"8731e29b4cb6","_type":"block","children":[{"_key":"36a4d89f1936","_type":"span","marks":["strong"],"text":"REFERENCES:"}],"markDefs":[],"style":"normal"},{"_key":"32d770281cc4","_type":"block","children":[{"_key":"a7773bc4105a0","_type":"span","marks":["strong"],"text":"1. Uniswap V3 whitepaper ("},{"_key":"a7773bc4105a1","_type":"span","marks":["e986ad215b80"],"text":"https://uniswap.org/whitepaper-v3.pdf"},{"_key":"a7773bc4105a2","_type":"span","marks":[],"text":")"}],"markDefs":[{"_key":"e986ad215b80","_type":"link","href":"https://uniswap.org/whitepaper-v3.pdf"}],"style":"normal"},{"_key":"c705a28a128d","_type":"block","children":[{"_key":"fde87373a3170","_type":"span","marks":["strong"],"text":"2. Uniswap V3 architecture - Finematics ("},{"_key":"fde87373a3171","_type":"span","marks":["9861e73277a1","strong"],"text":"https://www.youtube.com/watch?v=Ehm-OYBmlPM"},{"_key":"83ccd46f0ef8","_type":"span","marks":["strong"],"text":")"}],"markDefs":[{"_key":"9861e73277a1","_type":"link","href":"https://www.youtube.com/watch?v=Ehm-OYBmlPM"}],"style":"normal"},{"_key":"5d5a0ba0ba19","_type":"block","children":[{"_key":"5d214a9e89f2","_type":"span","marks":["strong"],"text":"3. Uniswap V3 docs - (https://docs.uniswap.org/)"}],"markDefs":[],"style":"normal"},{"_key":"17f138c49d9e","_type":"block","children":[{"_key":"b329ca8cf449","_type":"span","marks":[],"text":""}],"markDefs":[],"style":"normal"}],"date":"2021-05-20T07:39:00.000Z","mainImage":"https://cdn.sanity.io/images/9y1au457/production/460e348d66ae4ba0bb36782d64f1a8d820158247-346x278.png","slug":"a-technical-analysis-of-uniswap-v3","subtitle":null,"title":"A TECHNICAL ANALYSIS OF UNISWAP V3"}},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"a-technical-analysis-of-uniswap-v3"},"buildId":"Wd04JdrV7EafBKCrkdwgE","runtimeConfig":{},"isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>
>>>>>>> 77133a39a37afd37375acb5e633d89c6a1a20366:credmark-website/.serverless_nextjs/assets/static-pages/Wd04JdrV7EafBKCrkdwgE/blog/a-technical-analysis-of-uniswap-v3.html
